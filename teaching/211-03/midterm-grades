(module exam-grades mzscheme
  (require (lib "list.ss")
           (lib "etc.ss"))
  
  (define max-exam-scores '(10 15 15 10 5))
  
  (provide exam-grades max-exam-scores)
  
  (define exam-grades
    `(
      ("2825" "AGURKIS,JASON P" VKP (8 10 9 10 2))
      ("0092" "AL-DHAMEN, ALI" MF (10 12 13 8 3))
      ("9806" "ALDRICH, THOMAS P" VKP (10 14 15 10 5))
      ("4373" "ALLECA, DAVID J" VKP (10 15 15 10 5))
      ("8786" "ANDRE, PIERRETTE" VKP (0 0 0 0 0))
      ("4420" "ANIKUL, ALEXANDER" MF (10 15 15 10 4))
      ("3597" "ARANGO, NICHOLAS J" RJW (10 14 12 2 3))
      ("8545" "AROMANDO, MATTHEW T" RJW (10 11 12 9 0))
      ("3222" "ATLAS, MICHAEL R" VKP (10 15 14 9 5))
      ("6378" "BACHUN, NAZAR R" MF (8 6 0 0 0))
      ("2023" "BADALAMENTI, ALEXANDER" MF (3 10 0 3 0))
      ("4786" "BARBEE, LINDSEY A" VKP (9 15 15 10 1))
      ("7476" "BARRY, CHRISTOPHER" RJW (10 14 8 9 0))
      ("9669" "BAUERMEISTER, MISCHA K" VKP (10 15 15 10 5))
      ("1844" "BAXTER, RYAN J" MF (5 15 7 9 1))
      ("9997" "BERNADEL, KARL-HENS B" MF (6 11 7 7 2))
      ("9493" "BERNHARDT, CHRISTINE E" VKP (8 15 14 9 4))
      ("3644" "BIRON, TIMOTHY W" MF (10 14 11 10 4))
      ("8617" "BONANNO, BRIAN C" MF (9 7 8 9 2))
      ("3017" "BRENDEL, WILLIAM E" VKP (10 15 15 10 5))
      ("3079" "BRUEN, PATRICK J" VKP (10 15 9 10 4))
      ("9016" "BUCK, JEFFREY R" MF (10 15 10 9 0))
      ("9243" "BUCKLEY, PAUL R" MF (8 12 11 9 3))
      ("1404" "BURKE, CHRISTOPHER" VKP (8 15 10 10 4))
      ("3082" "CABRAL, ROBERTO M" MF (10 14 9 10 1))
      ("4587" "CALDWELL, ETHAN J" MF (10 14 14 10 5))
      ("1133" "CAPRICE, JOHN J" RJW (10 15 14 10 5))
      ("6783" "CASHORALI, TANYA M" VKP (8 14 14 9 3))
      ("0026" "CATALANO, MARK S" VKP (10 13 14 10 3))
      ("0815" "CAVALLA, VANESSA A" MF (10 15 14 8 3))
      ("2389" "CHAN, TERENCE Y" MF (10 12 8 8 0))
      ("4922" "CHAN, TIMOTHY C" RJW (4 12 6 6 0))
      ("8682" "CHICK, GREGORY E" MF (10 14 15 10 2))
      ("1039" "CHWICK, ADAM S" RJW (6 3 6 3 0))
      ("5491" "CIABURRI, NICHOLAS F" VKP (10 15 13 6 4))
      ("0105" "CLARK, DARYL W" MF (8 15 12 6 2))
      ("2257" "COCUZZO, DANIEL C" VKP (10 15 15 10 5))
      ("4806" "CONNOR, SHAUN D" MF (10 13 13 7 3))
      ("8830" "CUFONE, AGOSTINO J" MF (9 12 9 9 0))
      ("3549" "CUNDARI, GEOFFREY F" RJW (7 11 9 3 0))
      ("2292" "CUNNINGHAM, MAURICE L" MF (4 4 4 8 1))
      ("9627" "CURRAN, JAMES B" RJW (8 15 12 8 4))
      ("9982" "CZERW, ANASTASIA M" MF (10 15 14 10 0))
      ("3931" "DAVENPORT, ZACHARY J" VKP (10 13 15 10 1))
      ("2371" "DELORME, NOAH D" MF (10 15 15 10 5))
      ("1098" "DELOUISE, CHRISTOPHER" MF (6 6 3 1 0))
      ("8101" "DEMPSEY, WILLIAM T" MF (10 13 12 6 2))
      ("5622" "DESTEFANO, STEVEN E" VKP (10 13 15 10 4))
      ("7717" "DICKSON, TREVOR J" RJW (9 11 10 5 0))
      ("1818" "DILEO, JONATHAN R" MF (8 11 9 1 1))
      ("9664" "DILLANE, KEVIN W" MF (10 15 11 9 4))
      ("9661" "DILLMAN, BRANDON R" VKP (10 8 9 4 2))
      ("3772" "DONOVAN, MATTHEW D" VKP (10 15 12 10 4))
      ("2100" "DOOLEY-III, JOSEPH M" RJW (10 14 14 9 3))
      ("2828" "DORNER, ANDREW S" RJW (8 14 13 10 5))
      ("6262" "DRECKSAGE, JACOB B" VKP (9 15 14 10 5))
      ("8910" "DURNIAK, CAROLYN S" VKP (8 6 9 6 1))
      ("1438" "DWECK, NOAH J" RJW (10 14 12 5 0))
      ("2085" "EGAN, JARED M" MF (8 15 10 6 4))
      ("3506" "ELWOOD, GREGORY R" MF (10 14 11 5 4))
      ("2932" "ESPINOLA, ROMINA M" VKP (8 14 15 10 5))
      ("7006" "FERNANDEZ, JUAN" MF (8 14 14 10 4))
      ("8154" "FIER, DAVID" VKP (9 15 12 10 4))
      ("7128" "FLAMOUROPOULO, DIMITRIOS" VKP (8 15 15 9 4))
      ("8509" "FLANDERS, STEVEN M" MF (10 13 11 3 3))
      ("8078" "FOWLER, MATTHEW S" MF (10 15 14 10 3))
      ("2262" "FRANKLIN, BRIAN J" RJW (7 11 10 9 2))
      ("1245" "GARCIA, ARISTIDES" RJW (10 9 6 7 0))
      ("8871" "GAUTHIER, JORDAN J" MF (9 15 15 10 4))
      ("0320" "GILBERT, CHRISTINA B" MF ())
      ("2808" "GILLMOR, ALEXANDER S" MF (10 15 12 10 5))
      ("9051" "GORMAN, ANGELA D" VKP (3 9 2 7 0))
      ("0206" "GUNKEL, ADAM K" MF (10 15 13 7 4))
      ("3139" "HAGLER, LACRECIA D" MF (2 6 0 3 0))
      ("9366" "HANNON-RIZZA, ANDREW M" MF (10 15 11 9 5))
      ("1881" "HANRAHAN, KAITLYN F" VKP (10 15 15 10 5))
      ("1380" "HECKMAN, JUSTIN T" MF (8 14 7 10 0))
      ("7082" "HEINEGG, EVAN T" VKP (10 13 14 9 4))
      ("6311" "HENDERSON, ROBYN L" VKP (10 14 15 10 4))
      ("6888" "HICKEY, BRIAN W" RJW (9 11 7 8 0))
      ("2186" "HOLDER, HASANI" VKP (10 15 15 10 4))
      ("0183" "HONICKEL, GARY S" MF (10 15 11 10 2))
      ("7271" "HUBER, LAURA A" MF (10 12 15 10 5))
      ("0561" "HUYNH, PHUC N" RJW (10 15 10 6 4))
      ("2449" "JARMEL, DAVID C" MF (8 15 11 10 1))
      ("7629" "JOHNSON, BRETT M" MF (10 15 15 10 5))
      ("1851" "JOHNSON, RASHAINE A" MF (7 7 9 4 1))
      ("0293" "JONES, CARLTON C" RJW (8 12 7 6 1))
      ("6425" "JONES, MATTHEW B" MF (10 12 11 8 4))
      ("2393" "JOSEPH, ISAAC L" RJW (7 9 14 8 0))
      ("0358" "KACZYNSKI, KATARZYNA" RJW (10 14 10 3 0))
      ("6337" "KANESHIRO, CRAIG S" VKP (10 15 13 10 5))
      ("6434" "KARAMBELAS, CHRISTOPHER" RJW (7 14 12 8 2))
      ("5921" "LAFERRIERE, BRIAN S" MF (10 15 13 10 5))
      ("0839" "LAI, BAO" MF (8 8 4 5 1))
      ("3451" "LANDRY, JOSEPH R" VKP (10 15 13 8 5))
      ("2109" "LEAHY, DANA R" VKP ())
      ("3554" "LEBLANC, ANDREW R" VKP (10 14 12 9 4))
      ("4466" "LEE, JOHN F" VKP (10 13 9 10 3))
      ("5565" "LEONARD, JONATHAN G" VKP (10 12 12 10 5))
      ("0027" "LESZCZYNSKI, MICHAEL T" RJW (8 13 12 10 3))
      ("3458" "LEWIS, JOHN" MF (8 12 5 10 0))
      ("3769" "LI, ZHONGHUA" VKP (8 11 10 4 0))
      ("8207" "LOMBARDO, JASON I" MF (10 14 11 9 5))
      ("6423" "LU, JIMMY" RJW (10 15 15 10 4))
      ("1496" "LUMBIS, ALFRED P" VKP (8 7 12 7 3))
      ("4121" "LUSAS, DIANE N" RJW (9 11 10 8 0))
      ("5880" "MACLELLAN, PETER L" VKP (10 15 12 10 5))
      ("8651" "MARCHENKO, IGOR A" MF (10 15 15 9 5))
      ("7239" "MARK, AMY" VKP (10 15 12 10 5))
      ("1798" "MARTIN, ANDREW A" MF (10 14 15 10 4))
      ("9149" "MARTIN, SCOTT F" MF (8 12 12 7 2))
      ("2514" "MCCORMACK, KATE M" VKP (10 15 15 10 5))
      ("9257" "MCDEVITT, BRIAN V" MF (9 11 8 4 0))
      ("8318" "MCDONNELL, SEAN M" MF (10 14 14 10 4))
      ("2951" "MEDICO, ANDREW" VKP (9 14 15 10 5))
      ("9060" "MERGLER, SLOAN D" RJW (5 9 10 9 3))
      ("1252" "MINDER, ALEX" MF (9 6 7 8 0))
      ("9503" "MLODZIANOSKI, STEVEN J" MF (10 15 15 10 4))
      ("7418" "MUI, JERRY C" RJW (8 14 15 10 3))
      ("8171" "MULLEN, JAMES H" VKP (10 15 15 10 5))
      ("4083" "MUNCK, IAN P" RJW (10 12 14 10 5))
      ("6760" "MURPHY, DANIEL J" VKP (8 15 13 6 5))
      ("0680" "NGUYEN, VIET T" MF (7 14 6 4 1))
      ("3395" "NOAD, DEREK A" MF (10 15 15 10 5))
      ("2511" "OBER, RACHEL A" MF (10 15 13 10 4))
      ("3596" "O'CONNOR, MATTHEW N" MF (7 12 11 7 3))
      ("9553" "ONIGBANJO, TOLANI L" MF (8 10 6 7 1))
      ("5640" "O'ROURKE, SHAWN M" VKP (10 14 12 10 4))
      ("7682" "OTTO, GEORGIA M" RJW (8 13 12 9 5))
      ("1411" "OUELLETTE, DANIEL J" MF (10 8 9 0 1))
      ("6991" "PALMER, NATHAN A" VKP (10 15 15 9 5))
      ("4761" "PARRELLA, DANIEL S" RJW (9 14 10 9 0))
      ("6117" "PECK, DAVID J" MF (10 15 12 10 5))
      ("6709" "PEDLAR, BRYAN M" VKP (10 13 15 10 5))
      ("8085" "PETKOV, VENTZISLAV" VKP (10 14 14 10 5))
      ("2319" "PEZZUTO, DOMINIC S" MF (8 15 10 6 4))
      ("0787" "POLAD, AHMAD Z" MF (0 0 0 0 0))
      ("4238" "POULOS, GEORGE M" VKP (10 15 15 8 3))
      ("2114" "RAYMOULIK, RAHUL" MF (10 15 14 10 5))
      ("3139" "REILLY, BRETT W" VKP (10 15 14 10 5))
      ("9571" "ROCHE, KEVIN M" VKP (10 15 15 10 4))
      ("7983" "ROGERS, BRETT E" VKP (10 10 13 10 0))
      ("6893" "ROGODZINSKI, ANDREW" VKP (8 12 14 10 4))
      ("6535" "ROSENHOLTZ, JENNIFER L" MF (8 15 12 7 0))
      ("4934" "ROSS, DAVID W" VKP (10 11 14 8 5))
      ("1379" "RYEE, TAE-HYUNG" VKP (8 15 12 4 0))
      ("4449" "SABANTY, CHRISTOPHER" MF (7 13 4 8 1))
      ("3681" "SCHAFFER, RYAN H" MF (10 11 14 10 0))
      ("1371" "SCHMITT, KURT" MF (10 11 11 9 1))
      ("1792" "SCHNEIDER, ALAIN" RJW (1 11 4 0 0))
      ("2741" "SEITELMAN, ARI B" VKP (10 13 15 9 5))
      ("8528" "SEVIGNY, RICHARD F" RJW (10 14 13 10 4))
      ("5366" "SICKLER, JOSHUA D" MF (8 9 11 10 0))
      ("7699" "SIMONS, JONATHAN S" VKP (8 15 15 10 5))
      ("5552" "SMITH, JONATHAN T" MF (10 15 12 10 5))
      ("9216" "SOLOMON, JASON K" RJW (6 14 6 4 0))
      ("5011" "SPELMAN, JAMES J" VKP (7 11 14 7 5))
      ("0798" "SPINNEY, KIMBERLY C" VKP (6 10 8 9 0))
      ("0584" "SPROUSE, ANDREW L" MF (10 15 15 10 5))
      ("5842" "ST-JOHN, WILLIAM" MF (10 15 13 8 0))
      ("2235" "STRAUSS, DAVID A" MF (3 3 4 1 0))
      ("3586" "SULLIVAN, CHRISTIAN C" MF (5 8 3 0 0))
      ("5680" "SWEENEY, BRIAN G" VKP (9 15 11 10 2))
      ("6737" "TAMOWSKI, DANIEL J" MF (10 15 11 10 0))
      ("6181" "TASSINARI, TIMOTHY P" MF (10 15 14 10 4))
      ("7804" "TIRELLA, CHRISTIAN S" VKP (8 14 7 9 2))
      ("0420" "TON, PETER" RJW (8 15 15 10 5))
      ("7667" "TORGERSEN, MARK P" MF (7 9 5 3 0))
      ("6618" "TRAN, SON T" VKP (7 15 15 10 3))
      ("3567" "TRANG, HU J" RJW (5 11 13 10 3))
      ("6015" "TRIPP, CHRISTOPHER" VKP (10 13 15 10 4))
      ("1243" "TUPPER, KEVIN J" VKP (9 13 9 10 5))
      ("6525" "VALENTINE, JORDAN W" MF (8 10 4 1 1))
      ("3092" "VARGAS, JONATHAN S" VKP (8 11 1 4 0))
      ("8101" "VARNUM, JEFFREY R" VKP (10 13 5 9 2))
      ("8924" "VASKIS, JOHN W" MF (0 0 0 0 0))
      ("3184" "VASQUEZ, CHRISTOPHER" MF (9 14 13 7 3))
      ("3162" "VEGA, ZYLER" VKP (10 10 15 8 4))
      ("6068" "VIGEANT, MATTHEW J" VKP (8 15 12 10 5))
      ("1994" "WANAMAKER, BONNI M" MF (8 15 13 10 0))
      ("5357" "WARD, WILLIAM J" MF (10 14 11 6 0))
      ("9497" "WASKEWICH, RYAN G" MF (8 9 5 6 0))
      ("7391" "WEAVER, SAMUEL C" MF (8 15 15 9 3))
      ("2973" "WILLIAMS, CATHERINE P" RJW (10 15 11 9 0))
      ("2301" "WISNIEWSKI, DAVID V" MF (8 11 4 10 1))
      ("7769" "WOODBURY, GREGORY A" MF (10 14 15 9 5))
      ("9865" "YUEN, JERRY S" VKP (8 15 13 9 0))
      ("0345" "ZHU, WEN" VKP (8 11 7 5 0))
      ("3694" "ZHU, XUAN" VKP (7 10 15 10 5))
      ("2436" "ZHURAVLEVA, NATALIE A" MF (10 13 12 9 1)) 
      ))
  
  (define (get-grades s)
    (list-ref s 3))
  
  (define (get-score/bonus s)
    (apply + (get-grades s)) )
  
  (define (get-score s)
    (apply + (cdr (reverse (get-grades s)))))
  
  (define (done) (filter (lambda (x) (not (null? (list-ref x 3)))) exam-grades))
  (define (left) (filter (lambda (x) (null? (list-ref x 3))) exam-grades))
  
  (define took-test (done))
  
  (define (all-scores l) (map get-score l))
  (define (all-scores/bonus l) (map get-score/bonus l))
  
  (define scores/bonus (all-scores/bonus took-test))
  (define scores (all-scores took-test))
  
  (define (trunc n)
    (/ (floor (* 1000 n)) 1000.0))
  
  (define (avg l) (trunc (/ (apply + l) (length l))))
  
  (define avg-score (avg (all-scores took-test)))
  (define avg-score/bonus (avg (all-scores/bonus took-test)))
  
  (define (sqr x)
    (* x x))
  
  (define (variance l)
    (let ((a (avg l)))
      (/ (apply + (map (lambda (x) (sqr (- x a)))
                       l)) 
         (length l))))
  
  (define (stddev l)
    (trunc (sqrt (variance l))))
                  
  
  (define (prof-grades p l)
    (all-scores (filter (lambda (x) (equal? p (list-ref x 2))) l)))
  
  (define (prof-grades/bonus p l)
    (all-scores/bonus (filter (lambda (x) (equal? p (list-ref x 2))) l)))

  (define (prof-avg) (map (lambda (x) (list x (avg (prof-grades x took-test)))) (list 'mf 'vkp 'rjw)))
  (define (prof-avg/bonus) (map (lambda (x) (list x (avg (prof-grades/bonus x took-test)))) (list 'mf 'vkp 'rjw)))
  
  (define (scores/q q l)
    (map (lambda (x) (list-ref (get-grades x) (sub1 q))) l))
    
  
  (define (stats/q q l)
    (let ((a (avg (scores/q q l)))
          (sd (stddev (scores/q q l))))
      (list 'avg a 'stddev sd)))
  
  (define (all-stats/q l)
    (map (lambda (x) (cons x (stats/q x l))) '(1 2 3 4 5)))
  
  (define (map-grades f)
    (map f took-test))
  
  
  )
